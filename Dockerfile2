# Usa l'immagine base di Eclipse Temurin JDK 11
FROM eclipse-temurin:21 

# Crea una directory per l'applicazione
RUN mkdir -p /opt/app/eureka-service
RUN mkdir -p /opt/app/person-service
RUN mkdir -p /opt/app/security-service

# Aggiungi altre directory per gli altri servizi, se necessario

# Copia i file JAR dei servizi (assumendo che siano stati già costruiti)
COPY eureka-service/target/eureka-service-0.0.1-SNAPSHOT.jar /opt/app/eureka-service/eureka-service-0.0.1-SNAPSHOT.jar
COPY person-service/target/person-service-0.0.1-SNAPSHOT.jar /opt/app/person-service/person-service-0.0.1-SNAPSHOT.jar
COPY security-service/target/security-service-0.0.1-SNAPSHOT.jar /opt/app/security-service/security-service-0.0.1-SNAPSHOT.jar

# Copia i file JAR degli altri servizi, se presenti

# Porta di default per Eureka Server
EXPOSE 8761

# Porta di default per la tua web app (aggiungere altre porte se necessario)-security-gateway
EXPOSE 8081

#porta person service
EXPOSE 8082 

# Installa MySQL
RUN apt-get update && apt-get install -y mysql-server

# Porta di default per MySQL
EXPOSE 3306

# Crea una directory per il dump del database
#RUN mkdir -p /docker-entrypoint-initdb.d


# Copia il dump del database nella directory appena creata nel container
#COPY C:/Users/giova/Documents/dbmysql/gestionale16022024schema /docker-entrypoint-initdb.d/gestionale16022024schema
# Definisci le variabili d'ambiente per la connessione al database MySQL
ENV MYSQL_HOST=localhost
ENV MYSQL_PORT=3306
ENV MYSQL_DATABASE=gestionale16022024schema
ENV MYSQL_USERNAME=root
ENV MYSQL_PASSWORD=S3l3T1@ov3
#docker build -t dockerproject .
#docker run dockerprojectwithdbin


# Copia il file di configurazione di MySQL standard che già esiste
#COPY mysql/my.cnf /etc/mysql/my.cnf
# non fatto perchè standard esistente

# Comando di avvio dell'applicazione
CMD java -jar /opt/app/eureka-service/eureka-service-0.0.1-SNAPSHOT.jar  & java -jar /opt/app/person-service/person-service-0.0.1-SNAPSHOT.jar & java -jar /opt/app/security-service/security-service-0.0.1-SNAPSHOT.jar 

#CMD service mysql start && java -jar /opt/app/eureka-service/eureka-service-0.0.1-SNAPSHOT.jar  & java -jar /opt/app/person-service/person-service-0.0.1-SNAPSHOT.jar & java -jar /opt/app/security-service/security-service-0.0.1-SNAPSHOT.jar 

						
# Aggiungi comandi di avvio per gli altri servizi, se necessario